ALTER TABLE gam.Session ADD (SesOauthScope  lvarchar(1024) , SesOauthTokenExpires  INT , SesOauthTokenMaxRenew  SMALLINT , SesAutTypeName  CHAR(60) , SesExtToken2  lvarchar(1024) )

ALTER TABLE gam.SessionHistory ADD (SesHisOauthScope  lvarchar(1024) , SesHisOauthTokenExpires  INT , SesHisOauthTokenMaxRenew  SMALLINT , SesHisAppTokenExp  DateTime Year to Second , SesHisDeviceId  CHAR(40) , SesHisRefreshToken  CHAR(40) , SesHisAppId  DECIMAL( 12) , SesHisExtToken2  lvarchar(1024) )

CREATE TABLE gam.GXA0120 (RepId  INT NOT NULL , AppId  DECIMAL( 12) NOT NULL , AppName  CHAR(254) , AppGUID  CHAR(40) NOT NULL , AppVer  CHAR(60) NOT NULL , AppComName  CHAR(254) , AppTypeId  DECIMAL( 12) , AppParAppId  DECIMAL( 12) , AppDsc  CHAR(254) , AppCopyright  CHAR(254) , AppOrder  INT NOT NULL , AppRetMnuOptWithoutPrm  BOOLEAN NOT NULL , AppCurEnvId  DECIMAL( 12) , AppBaseAppId  DECIMAL( 12) , AppCreDate  DateTime Year to Second , AppCreUser  varchar(250,60) , AppUpdDate  DateTime Year to Second , AppUpdUser  varchar(250,60) , AppIsBaseApplication  BOOLEAN NOT NULL , AppCliId  CHAR(40) , AppCliSecret  CHAR(120) , AppCliUserGUID  CHAR(40) , AppCliImageURL  lvarchar(1024) , AppCliSiteURL  lvarchar(1024) , AppCliSiteDomain  lvarchar(1024) , AppCliRevoked  DateTime Year to Second , AppType  SMALLINT NOT NULL , AppCliEncKey  CHAR(32) NOT NULL , AppCliDefPrmGUID  CHAR(40) , AppAccessReqPrm  BOOLEAN NOT NULL , AppCliAccessUniqueByUser  BOOLEAN NOT NULL , AppCliAutoRegAnomymousUser  BOOLEAN NOT NULL , AppCliAllowRemoteAuth  BOOLEAN , AppCliAllowGetUserRoles  BOOLEAN , AppCliAllowGetUserAdditionalDa  BOOLEAN , AppCliLocalLoginURL  lvarchar(1024) )
Run conversion program for table Application
DROP TABLE gam.Application
RENAME TABLE gam.GXA0120 TO Application
ALTER TABLE gam.Application ADD CONSTRAINT PRIMARY KEY(RepId, AppId)
INSERT INTO gam.Repository (RepId, RepVer, RepUpg, RepDefAutTypeName, RepUserActType, RepUserActTimeOut, RepDefSecPolId, RepGenAud, RepUserRemMeTimeOut, RepGenSesSta, RepUserChrMinLog, RepGUID, RepCanRegUser, RepUserRemMeType, RepGiveAnoSes, RepAnoUserGUID, RepDefRoleId, RepCreDate, RepCreUser, RepUpdDate, RepUpdUser, RepNameSpace, RepUserRecPwdKeyTimeOut, RepUserReqPwd, RepUserReqEmail, RepUserReqFirstName, RepUserReqLastName, RepUserReqBir, RepUserReqGen, RepUserReqPhone, RepUserReqAddress, RepUserReqCity, RepUserReqState, RepUserReqCountry, RepUserReqPostCode, RepUserReqLng, RepUserReqTimeZone, RepUserReqPhoto, RepUserAttLogLockUser, RepUserAttLogLockSession, RepDsc, RepUserEmailSecAdm, RepUserTimeToUnblock, RepName, RepUserEmailUnique, RepAllowOauthAccess, RepUserIdentification, RepKeepSesOnlyOriIP, RepUserSessionCacheTimeout, RepAnoUserSDRoleId) SELECT DISTINCT RepId, ' ', ' ', NULL, 'A', 36, NULL, 'None', 0, 'None', 3, ' ', 'f', ' ', 'f', NULL, NULL, DATETIME(1-1-1 0:0:0) YEAR TO SECOND, ' ', DATETIME( 0001-01-01 00:00:00) YEAR TO SECOND, ' ', ' ', 120, 't', 't', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 'f', 8, 10, NULL, NULL, 30, ' ', 'f', 't', 'name', 'f', 60, NULL FROM gam.Application T WHERE NOT EXISTS (SELECT 1 FROM gam.Repository WHERE RepId = T.RepId)
INSERT INTO gam.Application (RepId, AppId, AppName, AppGUID, AppVer, AppComName, AppTypeId, AppParAppId, AppDsc, AppCopyright, AppOrder, AppRetMnuOptWithoutPrm, AppCurEnvId, AppBaseAppId, AppCreDate, AppCreUser, AppUpdDate, AppUpdUser, AppIsBaseApplication, AppCliId, AppCliSecret, AppCliUserGUID, AppCliImageURL, AppCliSiteURL, AppCliSiteDomain, AppCliRevoked, AppType, AppCliEncKey, AppCliDefPrmGUID, AppAccessReqPrm, AppCliAccessUniqueByUser, AppCliAutoRegAnomymousUser, AppCliAllowRemoteAuth, AppCliAllowGetUserRoles, AppCliAllowGetUserAdditionalDa, AppCliLocalLoginURL) SELECT DISTINCT RepId, AppId, AppName, AppGUID, AppVer, AppComName, AppTypeId, AppParAppId, AppDsc, AppCopyright, AppOrder, AppRetMnuOptWithoutPrm, AppCurEnvId, AppBaseAppId, AppCreDate, AppCreUser, AppUpdDate, AppUpdUser, AppIsBaseApplication, AppCliId, AppCliSecret, AppCliUserGUID, AppCliImageURL, AppCliSiteURL, AppCliSiteDomain, AppCliRevoked, AppType, AppCliEncKey, AppCliDefPrmGUID, AppAccessReqPrm, AppCliAccessUniqueByUser, AppCliAutoRegAnomymousUser, NULL, NULL, NULL, NULL FROM gam.Application T WHERE NOT EXISTS (SELECT 1 FROM gam.Application WHERE RepId = T.RepId AND AppId = T.AppId)
INSERT INTO gam.AppEnvironment (RepId, AppId, AppEnvId, AppEnvOrder, AppEnvGUID, AppEnvSrvHost, AppEnvSrvPort, AppEnvSrvVirDir, AppEnvSrvHttps, AppEnvSrvPgmPac, AppEnvSrvPgmExt, AppEnvName, AppEnvCreDate, AppEnvCreUser, AppEnvUpdDate, AppEnvUpdUser) SELECT DISTINCT RepId, AppId, AppCurEnvId, 0, '', '', NULL, NULL, 'f', NULL, NULL, NULL, NULL, NULL, DATETIME( 0001-01-01 00:00:00) YEAR TO SECOND, NULL FROM gam.Application T WHERE NOT EXISTS (SELECT 1 FROM gam.AppEnvironment WHERE RepId = T.RepId AND AppId = T.AppId AND AppEnvId = T.AppCurEnvId) AND (NOT AppCurEnvId IS NULL )
CREATE UNIQUE INDEX gam.UAPPLICATIONGUID ON gam.Application (RepId ,AppGUID )
CREATE UNIQUE INDEX gam.UAPPLICATIONCLIID ON gam.Application (RepId ,AppCliId )
CREATE INDEX gam.IAPPLICATIONPAR ON gam.Application (RepId ,AppParAppId )
CREATE INDEX gam.IAPPLICATIONBASE ON gam.Application (RepId ,AppBaseAppId )
CREATE INDEX gam.IAPPLICATIONTYPE ON gam.Application (RepId ,AppTypeId )
CREATE INDEX gam.UAPPLICATIONNAME ON gam.Application (RepId ,AppName )
CREATE INDEX gam.IAPPLICATIONENV ON gam.Application (RepId ,AppId ,AppCurEnvId )

CREATE TABLE gam.UserMemRoleProp (UserGUID  CHAR(40) NOT NULL , RepId  INT NOT NULL , UserMemRoleRoleId  DECIMAL( 12) NOT NULL , UserMemRolePropId  CHAR(60) NOT NULL , UserMemRolePropToken  CHAR(40) NOT NULL , UserMemRolePropValue  lvarchar(400) NOT NULL , PRIMARY KEY(UserGUID, RepId, UserMemRoleRoleId, UserMemRolePropId, UserMemRolePropToken))

CREATE TABLE gam.UserMemAppRoleProp (UserGUID  CHAR(40) NOT NULL , RepId  INT NOT NULL , UserMemAppRoleAppId  DECIMAL( 12) NOT NULL , UserMemAppRoleRoleId  DECIMAL( 12) NOT NULL , UserMemAppRolePropId  CHAR(60) NOT NULL , UserMemAppRolePropToken  CHAR(40) NOT NULL , UserMemAppRolePropValue  lvarchar(400) NOT NULL , PRIMARY KEY(UserGUID, RepId, UserMemAppRoleAppId, UserMemAppRoleRoleId, UserMemAppRolePropId, UserMemAppRolePropToken))

CREATE TABLE gam.SecurityPolicyProp (RepId  INT NOT NULL , SecPolId  INT NOT NULL , SecPolPropId  CHAR(60) NOT NULL , SecPolPropToken  CHAR(40) NOT NULL , SecPolPropValue  lvarchar(400) NOT NULL , PRIMARY KEY(RepId, SecPolId, SecPolPropId, SecPolPropToken))

DROP INDEX gam.IUSERMEMAPPROLE1
CREATE INDEX gam.IUSERMEMAPPROLEAPP ON gam.UserMemAppRole (RepId ,UserMemAppRoleAppId )
CREATE INDEX gam.IUSERMEMAPPROLEROLE ON gam.UserMemAppRole (RepId ,UserMemAppRoleRoleId )

RENAME TABLE gam.SessionHistoryHisLogAtt TO SessionHistoryLogAtt

UPDATE gam.SysPar SET SysParVal='3.0.6' WHERE SysParId='GAMVersion'
